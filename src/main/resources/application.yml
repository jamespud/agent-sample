spring:
  application:
    name: agent-sample

  # ====================== AI Models ======================
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:sk-placeholder}
      base-url: ${OPENAI_BASE_URL:https://api.openai.com}
      chat:
        options:
          model: ${OPENAI_CHAT_MODEL:gpt-4o}
        completions-path: /chat/completions
      embedding:
        options:
          model: ${OPENAI_EMBEDDING_MODEL:text-embedding-3-small}
          encoding-format: float
        embeddings-path: /embeddings/multimodal
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      chat:
        options:
          model: ${OLLAMA_CHAT_MODEL:llama3}
      embedding:
        options:
          model: ${OLLAMA_EMBEDDING_MODEL:nomic-embed-text}
    vectorstore:
      pgvector:
        index-type: hnsw
        distance-type: cosine_distance
        dimensions: 1536
    mcp:
      client:
        enabled: true
        stdio:
          servers-configuration: classpath:mcp-servers-config.json
        type: sync
    retry:
      max-attempts: 1
  # ====================== Data Sources ======================
  datasource:
    url: ${POSTGRES_URL:jdbc:postgresql://localhost:5432/agent}
    username: ${POSTGRES_USER:agent}
    password: ${POSTGRES_PASSWORD:agent}
    driver-class-name: org.postgresql.Driver

  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}

  cache:
    type: redis

# ====================== Application Config ======================
app:
  model:
    provider: ${MODEL_PROVIDER:openai}   # openai | ollama

  agent:
    max-steps: ${AGENT_MAX_STEPS:15}
    duplicate-threshold: ${AGENT_DUPLICATE_THRESHOLD:3}
    empty-threshold: ${AGENT_EMPTY_THRESHOLD:2}
    degrade-prefix: ${AGENT_DEGRADE_PREFIX:未查到相关数据，以下为直接回答：}
    system-prompt: |
      You are an intelligent AI agent. You can use tools to help answer questions.
      When you have gathered enough information, provide your final answer.
      If you need to stop, call the terminate tool with your final answer.
    next-step-prompt: |
      Based on the previous results, decide what to do next.

  mcp:
    servers:
    #      - id: default
    #        enabled: ${MCP_DEFAULT_ENABLED:false}
    #        transport: ${MCP_DEFAULT_TRANSPORT:sse}
    #        sse:
    #          url: ${MCP_DEFAULT_SSE_URL:http://localhost:8000/sse}
    #        stdio:
    #          command: ${MCP_DEFAULT_STDIO_CMD:}
    #          args: ${MCP_DEFAULT_STDIO_ARGS:}
    #        refresh:
    #          every-steps: 5
    namespace:
      enabled: true
      separator: "__"

  rag:
    enabled: ${RAG_ENABLED:true}
    top-k: ${RAG_TOP_K:5}
    chunk-size: ${RAG_CHUNK_SIZE:1000}
    chunk-overlap: ${RAG_CHUNK_OVERLAP:200}
    cache:
      embedding:
        ttl: ${RAG_CACHE_EMBEDDING_TTL:86400}
      retrieval:
        ttl: ${RAG_CACHE_RETRIEVAL_TTL:3600}

# ====================== Actuator ======================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics

logging:
  level:
    org.springframework.ai: TRACE
    com.github.spud.sample.ai: DEBUG
